/**
 * @file s21_is_less.c
 * @brief Реализация функции проверки "меньше" для decimal чисел
 * @details Сравнивает два decimal числа с учетом знаков и приведением к общему
 * масштабу
 */

#include "../s21_decimal.h"

/**
 * @brief Проверить, меньше ли первое число второго
 * @param a Первое число
 * @param b Второе число
 * @return 1 если a < b, 0 иначе
 * @details Алгоритм сравнения:
 *          1. Если оба числа равны нулю - результат false
 *          2. Приводим числа к общему масштабу
 *          3. Если знаки разные - отрицательное меньше положительного
 *          4. Если знаки одинаковые - сравниваем мантиссы с учетом знака
 */
int s21_is_less(s21_decimal a, s21_decimal b) {
  int result = 0;

  // Если хотя бы одно число не равно нулю
  if (!s21_is_zero(&a) || !s21_is_zero(&b)) {
    // Приводим числа к общему масштабу для корректного сравнения
    s21_to_common_scale(&a, &b);

    // Получаем знаки чисел
    int sa = s21_get_sign(&a);  // Знак первого числа
    int sb = s21_get_sign(&b);  // Знак второго числа

    if (sa == sb) {
      // Знаки одинаковые - сравниваем мантиссы

      uint32_t A[3], B[3];  // 96-битные мантиссы
      u96_from_dec(&a, A);  // Извлекаем мантиссу первого числа
      u96_from_dec(&b, B);  // Извлекаем мантиссу второго числа

      int c = u96_compare(A, B);  // Сравниваем мантиссы

      // Для отрицательных чисел результат сравнения инвертируется:
      // если |a| > |b|, то отрицательное a меньше отрицательного b
      result = (sa) ? c > 0 : c < 0;
    } else {
      // Знаки разные - отрицательное число всегда меньше положительного
      result = sa > sb;  // sa=1, sb=0 → true (отрицательное < положительного)
    }
  }
  // Если оба числа равны нулю, то a не меньше b (result = 0)

  return result;
}
