/**
 * @file s21_round.c
 * @brief Реализация функции банковского округления decimal числа
 * @details Округляет число до ближайшего целого с применением банковского
 * округления
 */

#include "s21_decimal.h"

/**
 * @brief Округлить число до ближайшего целого (банковское округление)
 * @param value Исходное число
 * @param result Указатель для сохранения результата
 * @return 0 при успехе, 1 при ошибке (некорректный указатель)
 * @details Использует банковское округление для каждого разряда:
 *          - Если остаток < 5: округляем вниз
 *          - Если остаток > 5: округляем вверх
 *          - Если остаток = 5: округляем к четному числу
 *          Примеры: 2.5 → 2, 3.5 → 4, 2.4 → 2, 2.6 → 3
 */
int s21_round(s21_decimal value, s21_decimal* result) {
  if (result) {
    *result = value;  // Копируем исходное число

    int s = s21_get_scale(
        &value);  // Получаем масштаб (количество знаков после запятой)

    if (s) {
      // Если есть дробная часть, применяем банковское округление
      for (int i = 0; i < s; ++i) {
        s21_scale_down_one_banker(
            result);  // Уменьшаем масштаб на 1 с банковским округлением
      }
      s21_set_scale(result, 0);  // Устанавливаем масштаб в 0 (целое число)
    }
    // Если масштаб уже 0, число уже целое - ничего не делаем
  }

  // Возвращаем 0 при успехе, 1 при ошибке
  return !result;
}
